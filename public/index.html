<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>
			Album delle figurine dei super eroi (AFSE)
		</title>
		<link rel="icon" href="/images/logo.png" type="image/x-icon">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
			integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

			<link rel="stylesheet" href="/css/style.css">
			<link rel="stylesheet" href="/css/card.css">
			<script src="/scripts/theme.js"></script>
		</head>
	<body>
		<div id="header">
			<img src ="/images/logo.png" class="logo">
			<h1>Hello christmas</h1>
			<a href="card_template_test.html"> Open Card</a>
		</div>
		<!--<h1>Here you see a test of printing a set of characters</h1>-->
		<div id="character_container">

		</div>
	</body>
	<script >
		//getFromMarvel('public/characters').
		async function getMarvelCarachters() {
			return await fetch('\lib')
				.then(response => response.json())
				.catch(error => console.log(error))

		}
	</script>
	<script>
			getMarvelCarachters()
				.then(response =>
					{	if (response.code !=200 ) {console.log("RESPONSE"+response.code);} else {
						console.log(response.data);
						var printed_characters_count =0; //Dichiarazione e inizializzazione della variabile
						var i=0;
						var sicurezza = 0;
						//for (let i = 0; i < response.data.count || printed_characters_count < 10; i++) {
							while (i < response.data.count || printed_characters_count < 10  || sicurezza <100) {
							var Div_Car = document.getElementById("character_container");
							var desc;
							if (response.data.results[i].description) {desc = response.data.results[i].description;} else {desc = response.data.results[i].name+" story's is so secret that nobody kwnows it.";} ;
							//Se l'immagine non è nulla o la descrizione non è nulla non lo stampo
							if (response.data.results[i].description || response.data.results[i].thumbnail.path !="http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available") 
							{
								Div_Car.innerHTML =
									Div_Car.innerHTML + 
									'<div class="card card-shine-effect-metal" id="char-'+response.data.results[i].id+'">'+
										'<div class="card-header">'+
											response.data.results[i].name+
										'</div>'+
										//'<hr>'+
										'<div class="card-content">'+
											'<img src="'+response.data.results[i].thumbnail.path.replace(/"/g, "")+'.'+response.data.results[i].thumbnail.extension+'">'+
										'</div>'+
										'<div class="card-body">'+
											desc+
										'</div>'+
										'<div class="card-footer">'+
											response.attributionText+
										'</div>'+
									'</div>';
							console.log(response.data.results[i]);	
							printed_characters_count++;	
							if (printed_characters_count % 3 == 0) 
								{
									console.log("Ho stampato il terzo!");
									//Div_Car.innerHTML = Div_Car.innerHTML + '<br>';
								}
							console.log("Stampati->"+printed_characters_count);
							} else
							{
							console.warn("Dato vuoto");
							console.log(response.data.results[i]);
							}
							sicurezza ++;
							if (sicurezza  >99 ) { console.error("sicurezza è saltata"); break; }
							console.log("sicurezza ->"+sicurezza);
							i++;
				//Stampo l'
				//Div_Car.innerHTML + '<br><img style="height:100px;width:100px;" src="'+response.data.results[i].thumbnail.path.replace(/"/g, "")+'.'+response.data.results[i].thumbnail.extension+'"><b>'+response.data.results[i].name+'</b>';
				
						}




						}
					}
				) 
				.catch(response => console.log("Error!"+response))
	</script>
</html>
